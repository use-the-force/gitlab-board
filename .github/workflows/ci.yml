name: CI
run-name: CI on ${{ github.ref_type}} ${{ github.ref_name }}

on: push

jobs:
  api:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Build
        run: docker build . --file ./docker/api/Dockerfile --tag api:${{ github.sha }}
      - name: Run Container
        run: docker run -i api:${{ github.sha }} --env-file ./.env.example
      - name: Lint
        run: docker exec -i api:${{ github.sha }} flake8 .
  frontend:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Build
        run: docker build . --file ./docker/frontend/Dockerfile --tag frontend:${{ github.sha }}
